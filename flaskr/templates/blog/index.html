{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Tasks{% endblock %}
    <a class="action" href="{{ url_for('blog.create') }}">
      <img src="{{ url_for('static', filename='create-task.png') }}"
        alt="Create task"
        class="task-icon"
        title="Create task"
        style="cursor: pointer; margin-left: 20px;">
    </a>
  </h1>
  

  <!-- {% if g.user %}
    <a class="action" href="{{ url_for('blog.create') }}">New</a>
  {% endif %} -->
{% endblock %}

{% block content %}
  <div class="dad-tasks">
    {% for task in tasks %}
      <div class="task" data-id="{{ task['id'] }}">
        <div class="son-tasks">
          <div class="circle" data-id="{{ task['id'] }}"></div>
          <h4>{{ task['title'] }}</h4>
          <h6>({{ task['term'] }})</h6>
          <div class="dad-action">
            <a class="action" href="{{ url_for('blog.update', id=task['id']) }}" title="Edit"> 
              <i class="bi bi-pencil"></i>
            </a>
          </div>
          <div class="dad-action">
            <a class="delete" href="{{ url_for('blog.delete', id=task['id']) }}" title="Delete"
               onclick="return confirm('Are you sure that want to delete this task?');">
              <i class="bi bi-trash"></i>
            </a>
          </div>
        </div>
        <p style="margin-left: 12px;">{{ task['description'] }}</p>
      </div>
    {% endfor %}
  </div>

  <script>
    // Script para gerenciar o estado das tarefas (feito ou nÃ£o feito)
    document.querySelectorAll('.circle').forEach(circle => {
    const id = circle.dataset.id;

    // ðŸ”¹ Restaura o estado salvo no localStorage
    if (localStorage.getItem("task-" + id) === "done") {
      circle.classList.add("checked");
      circle.closest(".task").classList.add("checked");
    }

    // ðŸ”¹ Adiciona o evento de clique
    circle.addEventListener('click', () => {
      const task = circle.closest(".task");
      const checked = task.classList.toggle("checked");
      circle.classList.toggle("checked");

      // ðŸ”¹ Salva o estado individual no localStorage
      if (checked) {
        localStorage.setItem("task-" + id, "done");
      } else {
        localStorage.removeItem("task-" + id);
      }
    });
  });
</script>

{% endblock %}